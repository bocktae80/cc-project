# 훅 종류 상세 레퍼런스 📖

> 4종 훅의 모든 것을 알아보자!

---

## 1. PreToolUse

### 개요

| 항목 | 내용 |
|------|------|
| **실행 시점** | 도구 사용 **직전** |
| **차단 가능** | ✅ 가능 (`exit 2`) |
| **주요 용도** | 검증, 차단, 사전 확인 |

### 환경변수

| 변수 | 사용 가능 | 설명 |
|------|----------|------|
| `CLAUDE_TOOL_NAME` | ✅ | 사용할 도구 이름 |
| `CLAUDE_TOOL_INPUT` | ✅ | 도구에 전달될 입력 (JSON) |
| `CLAUDE_TOOL_RESULT` | ❌ | 아직 실행 전이라 없음 |

### Exit Code

| 코드 | 의미 | 결과 |
|------|------|------|
| `exit 0` | 허용 | 도구가 정상 실행됨 |
| `exit 2` | 차단 | 도구 실행이 취소됨. 훅의 stdout이 클로드에게 전달됨 |
| `exit 1` | 에러 | 훅 자체 오류. 도구는 실행됨 (차단 아님!) |

### stdout 동작

- `exit 0`일 때: stdout이 클로드에게 메시지로 전달됨 (정보 제공)
- `exit 2`일 때: stdout이 클로드에게 차단 사유로 전달됨
- `exit 1`일 때: stderr가 에러 로그로 기록됨

### 예시

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write",
        "hook": "echo '파일 작성 전 확인!'"
      },
      {
        "matcher": "Bash",
        "hook": "bash ./check-command.sh"
      }
    ]
  }
}
```

### 제한사항

- 훅 실행에 시간이 오래 걸리면 타임아웃될 수 있음
- 여러 PreToolUse 훅이 있으면 **순서대로** 실행됨
- 하나라도 `exit 2`를 반환하면 도구가 차단됨

---

## 2. PostToolUse

### 개요

| 항목 | 내용 |
|------|------|
| **실행 시점** | 도구 사용 **직후** |
| **차단 가능** | ❌ 불가 (이미 실행됨) |
| **주요 용도** | 기록, 알림, 후처리 |

### 환경변수

| 변수 | 사용 가능 | 설명 |
|------|----------|------|
| `CLAUDE_TOOL_NAME` | ✅ | 사용된 도구 이름 |
| `CLAUDE_TOOL_INPUT` | ✅ | 도구에 전달된 입력 (JSON) |
| `CLAUDE_TOOL_RESULT` | ✅ | 도구 실행 결과 |

### Exit Code

| 코드 | 의미 | 결과 |
|------|------|------|
| `exit 0` | 정상 | stdout이 클로드에게 전달됨 |
| `exit 1` | 에러 | 에러 로그 기록 (도구 결과에 영향 없음) |
| `exit 2` | (무시됨) | 이미 실행 후이므로 차단 불가 |

### 예시

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write",
        "hook": "echo '✅ 파일 작성 완료!'"
      },
      {
        "matcher": "",
        "hook": "bash ./log-result.sh"
      }
    ]
  }
}
```

### 제한사항

- **차단 불가** — exit 2를 반환해도 이미 실행된 결과를 되돌릴 수 없음
- `CLAUDE_TOOL_RESULT`가 매우 클 수 있음 (큰 파일 읽기 결과 등)

---

## 3. Notification

### 개요

| 항목 | 내용 |
|------|------|
| **실행 시점** | 사용자에게 알림 발생 시 |
| **차단 가능** | ❌ 불가 |
| **주요 용도** | 외부 알림 전달 |

### 환경변수

| 변수 | 사용 가능 | 설명 |
|------|----------|------|
| `CLAUDE_TOOL_NAME` | ❌ | 도구 관련 훅이 아님 |
| `CLAUDE_TOOL_INPUT` | ❌ | 도구 관련 훅이 아님 |
| `CLAUDE_TOOL_RESULT` | ❌ | 도구 관련 훅이 아님 |

### 예시

```json
{
  "hooks": {
    "Notification": [
      {
        "matcher": "",
        "hook": "osascript -e 'display notification \"클로드 알림!\" with title \"Claude Code\"'"
      }
    ]
  }
}
```

> 💡 macOS에서 `osascript`를 사용하면 데스크탑 알림을 표시할 수 있어요!

### 제한사항

- 도구 관련 환경변수를 사용할 수 없음
- 알림 내용은 stdin으로 전달됨

---

## 4. Stop

### 개요

| 항목 | 내용 |
|------|------|
| **실행 시점** | 클로드와의 대화 종료 시 |
| **차단 가능** | ❌ 불가 |
| **주요 용도** | 정리, 요약, 세션 기록 |

### 환경변수

| 변수 | 사용 가능 | 설명 |
|------|----------|------|
| `CLAUDE_TOOL_NAME` | ❌ | 도구 관련 훅이 아님 |
| `CLAUDE_TOOL_INPUT` | ❌ | 도구 관련 훅이 아님 |
| `CLAUDE_TOOL_RESULT` | ❌ | 도구 관련 훅이 아님 |

### 예시

```json
{
  "hooks": {
    "Stop": [
      {
        "matcher": "",
        "hook": "echo \"세션 종료: $(date)\" >> session-log.txt"
      }
    ]
  }
}
```

### 제한사항

- 대화가 비정상 종료되면 실행되지 않을 수 있음
- 정리 작업은 빠르게 끝나도록 작성해야 함

---

## 전체 비교표

| 항목 | PreToolUse | PostToolUse | Notification | Stop |
|------|-----------|------------|-------------|------|
| 실행 시점 | 도구 사용 전 | 도구 사용 후 | 알림 발생 시 | 대화 종료 시 |
| 차단 가능 | ✅ `exit 2` | ❌ | ❌ | ❌ |
| TOOL_NAME | ✅ | ✅ | ❌ | ❌ |
| TOOL_INPUT | ✅ | ✅ | ❌ | ❌ |
| TOOL_RESULT | ❌ | ✅ | ❌ | ❌ |
| matcher | 도구 이름 | 도구 이름 | - | - |
| 비유 | 🚪 문 열기 전 | 🚪 문 닫은 후 | 🔔 알림 벨 | 🏫 하교 벨 |

---

## matcher 패턴 정리

| matcher 값 | 동작 |
|-----------|------|
| `""` (빈 문자열) | 모든 도구에 반응 |
| `"Write"` | Write 도구에만 반응 |
| `"Edit"` | Edit 도구에만 반응 |
| `"Bash"` | Bash 도구에만 반응 |
| `"Read"` | Read 도구에만 반응 |
| `"Glob"` | Glob 도구에만 반응 |
| `"Grep"` | Grep 도구에만 반응 |
