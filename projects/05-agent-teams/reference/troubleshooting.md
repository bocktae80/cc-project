# 자주 겪는 문제와 해결법 ⭐⭐

> Agent Teams를 사용하다가 문제가 생겼나요? 여기서 해결법을 찾아보세요.

---

## 목차

1. [환경변수 미설정 에러](#1-환경변수-미설정-에러)
2. [idle 상태 혼동](#2-idle-상태-혼동)
3. [비용 절약 팁](#3-비용-절약-팁)
4. [팀 삭제 실패](#4-팀-삭제-실패)
5. [태스크 의존성 순환](#5-태스크-의존성-순환)
6. [메시지 미전달](#6-메시지-미전달)

---

## 1. 환경변수 미설정 에러

### 증상

```
Error: CLAUDE_AGENT_TEAMS not set
```

Agent Teams 기능을 사용하려 했는데 환경변수가 설정되지 않았다는 에러가 나옵니다.

### 원인

Agent Teams는 아직 실험적 기능이라, 환경변수를 통해 명시적으로 활성화해야 합니다.

### 해결 방법

`.zshrc` (또는 `.bashrc`) 파일에 환경변수를 추가하세요:

```bash
# ~/.zshrc 또는 ~/.bashrc에 추가
export CLAUDE_AGENT_TEAMS=1
```

추가한 후 터미널을 재시작하거나 아래 명령을 실행합니다:

```bash
source ~/.zshrc
```

확인 방법:
```bash
echo $CLAUDE_AGENT_TEAMS
# 1이 출력되면 성공!
```

---

## 2. idle 상태 혼동

### 증상

에이전트가 `idle` 상태인데, 멈춘 건지 정상인지 헷갈립니다.

### 설명

**idle은 정상 상태입니다!** 에러가 아닙니다.

```
에이전트 상태 흐름:
작업중 → idle (할 일 완료, 대기 중) → 작업중 (새 메시지/태스크)
```

idle은 "할 일을 다 끝내고, 다음 지시를 기다리는 중"이라는 뜻이에요.

### 대처 방법

| 상황 | 해야 할 일 |
|------|-----------|
| 아직 할 일이 있다 | 새 태스크를 만들거나 메시지를 보내세요 |
| 모든 작업이 끝났다 | `shutdown_request`를 보내서 종료하세요 |
| 뭘 하고 있는지 모르겠다 | `TaskList`로 태스크 현황을 확인하세요 |

---

## 3. 비용 절약 팁

Agent Teams는 에이전트 수만큼 비용이 발생합니다. 현명하게 사용하세요!

### 팁 1: 작은 팀으로 시작

```
나쁜 예: 에이전트 5명으로 시작
좋은 예: 에이전트 2-3명으로 시작, 필요하면 추가
```

### 팁 2: 빠르게 shutdown

작업이 끝난 에이전트는 바로 종료하세요. idle 상태에서도 유지 비용이 발생합니다.

```
작업 완료 → 즉시 shutdown_request → 비용 절약!
```

### 팁 3: Haiku 모델 활용

간단한 작업에는 비용이 낮은 Haiku 모델을 사용하세요.

| 모델 | 적합한 작업 | 비용 |
|------|-----------|------|
| Opus | 복잡한 설계, 아키텍처 | 높음 |
| Sonnet | 일반적인 코딩 | 중간 |
| Haiku | 단순 검색, 파일 수정 | 낮음 |

### 팁 4: Task(서브에이전트)와 적절히 혼합

모든 작업에 Agent Teams를 쓸 필요는 없습니다. 간단한 작업은 Task(서브에이전트)가 더 효율적입니다.

---

## 4. 팀 삭제 실패

### 증상

`TeamDelete`를 실행했는데 팀이 삭제되지 않습니다.

### 원인

활성 상태(`active` 또는 `idle`)의 팀원이 남아있으면 팀을 삭제할 수 없습니다.

### 해결 방법

1. 먼저 모든 팀원에게 shutdown을 요청합니다:

```json
{
  "type": "shutdown_request",
  "recipient": "frontend",
  "content": "작업 종료합니다"
}
```

2. 모든 팀원이 종료된 것을 확인합니다.

3. 그 다음 `TeamDelete`를 실행합니다.

```
순서: shutdown_request (모든 멤버) → 종료 확인 → TeamDelete
```

---

## 5. 태스크 의존성 순환

### 증상

태스크가 영원히 `pending` 상태에서 벗어나지 못합니다.

### 원인

의존성이 **순환**되어 서로를 기다리고 있습니다.

```
잘못된 예:
태스크 #1 (blockedBy: [#2])  ← #2를 기다림
태스크 #2 (blockedBy: [#1])  ← #1을 기다림

→ 서로 기다리므로 둘 다 영원히 시작 못함!
```

### 해결 방법

1. `TaskList`로 현재 의존성 구조를 확인합니다.
2. 순환을 만드는 의존성을 `TaskUpdate`로 제거합니다.
3. 의존성을 다시 올바르게 설정합니다.

```
올바른 예:
태스크 #1 (blockedBy: 없음)  ← 바로 시작 가능!
태스크 #2 (blockedBy: [#1])  ← #1이 끝나면 시작
```

> **방지법**: 의존성을 설정할 때 "A → B → C → A" 같은 순환이 없는지 확인하세요.

---

## 6. 메시지 미전달

### 증상

`SendMessage`로 메시지를 보냈는데 상대방이 반응하지 않습니다.

### 가능한 원인과 해결법

| 원인 | 확인 방법 | 해결 |
|------|----------|------|
| **recipient 이름 오타** | config.json의 멤버 이름 확인 | 정확한 이름으로 다시 전송 |
| **상대방이 shutdown 상태** | TaskList에서 상태 확인 | 종료된 에이전트에게는 보낼 수 없음 |
| **상대방이 작업 중** | 잠시 기다리기 | 현재 작업이 끝나면 메시지를 처리함 |

### 주의사항

- `recipient`에는 반드시 **에이전트 이름**을 사용하세요 (UUID가 아님)
- 이름은 대소문자를 구분합니다
- `broadcast`를 보낼 때는 `recipient`가 필요 없습니다

```json
{
  "type": "message",
  "recipient": "backend",
  "content": "확인 부탁합니다",
  "summary": "확인 요청"
}
```

> `"recipient": "Backend"` (X) — 대소문자 주의!
> `"recipient": "backend"` (O)

---

## 문제가 계속되면?

1. 클로드 코드를 **재시작**해보세요
2. `~/.claude/teams/` 폴더에서 팀 설정 파일을 직접 확인해보세요
3. [클로드 코드 공식 문서](https://docs.anthropic.com/en/docs/claude-code)를 참고하세요

---

## 다음으로 읽기

- [도구 API 레퍼런스](tool-api.md) — 도구 파라미터를 다시 확인하고 싶다면
- [Agent Teams 개념 이해](../concepts/overview.md) — 기본 개념을 복습하고 싶다면
