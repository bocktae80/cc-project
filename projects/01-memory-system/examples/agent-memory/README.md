# 예제 3: 에이전트 메모리 ⭐⭐⭐

> 클로드의 "조수"(서브에이전트)가 일하면서 배운 것을 기억하는 방법을 알아보자!

## 이 예제에서 배우는 것

- 서브에이전트가 뭔지
- 에이전트가 학습 내용을 기록하는 MEMORY.md
- 커스텀 에이전트를 만들고 메모리를 설정하는 방법

---

## 서브에이전트란?

클로드 코드에게 복잡한 작업을 시키면, 클로드는 "조수"를 부를 수 있습니다.
이 조수를 **서브에이전트**(subagent)라고 합니다.

```
나 → 클로드 (메인) → 서브에이전트 (조수)
        │                  │
        │ "이 코드         │ "네, 분석
        │  분석해줘"       │  해볼게요!"
        │                  │
        └──────────────────┘
```

### 일상 비유

- **클로드** = 선생님
- **서브에이전트** = 조교
- **MEMORY.md** = 조교의 업무 노트

조교가 일하면서 "이 프로젝트에서는 이런 패턴을 쓰는구나"를 배우면,
그걸 노트(MEMORY.md)에 적어둡니다.
다음에 비슷한 일을 할 때 노트를 보고 더 잘 할 수 있어요!

---

## 에이전트 메모리 동작 방식

### 메모리 설정 옵션

에이전트를 만들 때, `memory` 옵션으로 메모리 범위를 정할 수 있습니다:

| 설정 | 뜻 | 누가 볼 수 있나 |
|------|-----|----------------|
| `memory: user` | 내 개인 메모리 | 나만 (모든 프로젝트) |
| `memory: project` | 프로젝트 메모리 | 이 프로젝트 사용자 전원 |
| (설정 안 함) | 메모리 없음 | 매번 처음부터 |

### 저장 위치

```
memory: user    → ~/.claude/agent-memory/<에이전트이름>/MEMORY.md
memory: project → .claude/agent-memory/<에이전트이름>/MEMORY.md
```

### 동작 흐름

```
에이전트 작업 시작
    │
    ▼
기존 MEMORY.md 읽기 (있으면)
    │
    ▼
작업 수행하면서 패턴 학습
    │
    ▼
작업 끝날 때 MEMORY.md 업데이트
    │
    ▼
다음 실행 시 MEMORY.md 참고!
```

---

## 데모: 코드 리뷰 에이전트

이 예제에는 코드 리뷰를 해주는 커스텀 에이전트가 있습니다.

### 에이전트 설정 파일

`.claude/agents/my-reviewer.md`를 살펴보세요:

```markdown
---
memory: project
---

코드를 리뷰하고, 개선점을 알려주는 에이전트입니다.
```

`memory: project` 설정으로, 이 에이전트가 배운 것은 프로젝트에 저장됩니다.

### 샘플 코드

`sample-code/` 폴더에 두 가지 코드가 있습니다:

- `good.js` — 잘 작성된 코드 (에이전트가 "좋은 패턴"으로 기억)
- `bad.js` — 개선이 필요한 코드 (에이전트가 "주의할 점"으로 기억)

---

## 따라하기

### Step 1: 에이전트 설정 확인

```bash
# 에이전트 설정 파일 확인
cat .claude/agents/my-reviewer.md
```

### Step 2: 에이전트로 코드 리뷰 실행

클로드 코드에서:

```
> @my-reviewer sample-code/bad.js 파일을 리뷰해줘
```

또는:

```
> /agents 명령으로 에이전트 목록 확인
```

### Step 3: 메모리 축적 관찰

에이전트가 여러 번 리뷰를 하면, `MEMORY.md`가 자동으로 생성/업데이트됩니다.

예상되는 메모리 내용은 `expected-memory/MEMORY.md`를 참고하세요.

### Step 4: 메모리 효과 확인

에이전트가 메모리를 쌓은 후, 다시 리뷰를 요청하면:
- 이전에 발견한 패턴을 기억합니다
- "이 프로젝트에서 자주 보이는 문제"를 알려줍니다
- 프로젝트에 맞는 맞춤 피드백을 줍니다

---

## 직접 만들어보기

나만의 에이전트를 만들어보세요!

### 1. 에이전트 파일 만들기

`.claude/agents/my-agent.md` 파일을 만듭니다:

```markdown
---
memory: project
---

# 나만의 에이전트

(여기에 에이전트가 할 일을 적으세요)

예시:
- 코드를 한국어로 설명해주는 에이전트
- 변수명을 검사하는 에이전트
- TODO 주석을 찾아주는 에이전트
```

### 2. 여러 번 사용해보기

같은 에이전트를 여러 번 사용하면, MEMORY.md에 학습 내용이 쌓입니다.

### 3. 메모리 확인하기

```bash
# 에이전트 메모리 확인
cat .claude/agent-memory/my-agent/MEMORY.md
```

---

## 핵심 정리

```
에이전트 메모리 = 조수의 업무 노트

- 에이전트가 작업하면서 배운 것을 MEMORY.md에 기록
- 다음 작업 때 참고해서 더 나은 결과
- memory: user (개인) / memory: project (프로젝트 공유)
- 커스텀 에이전트는 .claude/agents/ 폴더에 생성
```

---

## 파일 구조

```
agent-memory/
├── README.md                 ← 지금 읽고 있는 파일
├── .claude/
│   └── agents/
│       └── my-reviewer.md    ← 코드 리뷰 에이전트 설정
├── sample-code/
│   ├── good.js               ← 잘 작성된 코드
│   └── bad.js                ← 개선이 필요한 코드
└── expected-memory/
    └── MEMORY.md             ← 에이전트가 쌓을 메모리 예시
```
