# AI 스캔 vs 기존 정적분석 -- CCTV와 경비원의 협력

> 둘 다 필요하다! 각각의 장단점을 이해하자

---

## CCTV 방식: 기존 정적분석 도구

"정적분석"이란 코드를 **실행하지 않고**, 텍스트 자체를 분석하는 것입니다.

```
기존 정적분석의 작동 원리
-------------------------------------

규칙 데이터베이스:
+------------------------------------------+
| 규칙 #001: 위험 함수 사용 -> 경고          |
| 규칙 #002: DOM에 직접 삽입 -> 경고         |
| 규칙 #003: "password" 변수 하드코딩 -> 경고|
| 규칙 #004: HTTP (HTTPS 아님) -> 경고       |
| 규칙 #005: console.log 남음 -> 정보        |
| ...                                      |
| 규칙 #500: _____________ -> _____         |
+------------------------------------------+

스캔 과정:
코드 한 줄 한 줄 -> 규칙 #001 매칭? -> No -> 다음 규칙
                -> 규칙 #002 매칭? -> Yes! -> 경고 출력
                -> 규칙 #003 매칭? -> No -> 다음 규칙
                -> ...

결과: 규칙에 매칭된 것만 보고
```

**장점:**
- 매우 빠름 (대규모 코드베이스도 몇 초)
- 일관적 (같은 코드는 항상 같은 결과)
- 오탐이 적음 (규칙이 정확하면)

**단점:**
- 규칙에 없는 새로운 패턴은 못 찾음
- 코드의 "의도"를 이해 못함
- 문맥(context) 무시

대표 도구: ESLint (보안 플러그인), SonarQube, Semgrep

---

## AI 경비원 방식: Claude 보안 스캔

```
AI 보안 스캔의 작동 원리
-------------------------------------

분석 과정:
+------------------------------------------+
| 1. 코드 전체를 읽음                       |
|    "이 파일은 사용자 로그인을 처리하네"     |
|                                          |
| 2. 데이터 흐름 추적                       |
|    "사용자 입력 -> 여기서 검증? -> 안 함!  |
|     -> DB 쿼리에 직접 들어감"             |
|                                          |
| 3. 맥락 이해                             |
|    "이 함수는 관리자 전용인데,            |
|     권한 확인 코드가 없네?"              |
|                                          |
| 4. 복합 취약점 발견                       |
|    "A 파일의 문제 + B 파일의 문제가       |
|     합쳐지면 더 위험해질 수 있다"         |
+------------------------------------------+

결과: 맥락을 이해한 상세 분석 + 수정 제안
```

**장점:**
- 새로운 유형의 취약점도 발견 가능
- 코드의 의도와 맥락을 이해
- 수정 방법까지 제안
- 여러 파일에 걸친 복합 문제 감지

**단점:**
- 상대적으로 느림
- 가끔 오탐 (위험하지 않은 것을 위험하다고 판단)
- 같은 코드에 대해 다른 결과가 나올 수 있음

---

## 비교 표

```
+-----------------+------------------+------------------+
|     비교 항목    |  기존 도구 (CCTV) |  AI 스캔 (경비원) |
+-----------------+------------------+------------------+
| 속도            |  매우 빠름        |  느림             |
| 일관성          |  항상 같은 결과   |  결과가 다를 수    |
| 새로운 취약점    |  못 찾음          |  추론으로 발견     |
| 맥락 이해       |  없음             |  있음             |
| 복합 취약점     |  개별만 감지      |  여러 파일 연결    |
| 오탐율          |  낮음             |  중간             |
| 수정 제안       |  없거나 단순      |  상세한 코드 제안  |
| 비용            |  무료~저렴        |  Enterprise 필요  |
| 설정            |  규칙 파일 필요   |  질문만 하면 됨    |
+-----------------+------------------+------------------+
```

---

## 실제 예시: 같은 코드를 두 방식으로 스캔

```javascript
// 분석 대상 코드
app.get('/api/user', (req, res) => {
  const userId = req.query.id;
  const query = `SELECT * FROM users WHERE id = ${userId}`;
  db.query(query, (err, result) => {
    if (err) {
      res.status(500).send(err.message);
    }
    res.json(result);
  });
});
```

### 기존 도구의 분석 결과

```
[WARN] Line 3: Template literal in SQL query - possible SQL injection
```

1개 경고. 끝.

### AI 스캔의 분석 결과

```
[심각] SQL 인젝션 (Line 3)
  - req.query.id가 검증 없이 SQL 쿼리에 직접 삽입됨
  - 공격자가 id=1 OR 1=1 로 모든 사용자 정보 탈취 가능
  - 수정: 파라미터화 쿼리 사용 (db.query('SELECT ... WHERE id = ?', [userId]))

[높음] 에러 정보 노출 (Line 5)
  - err.message를 클라이언트에 그대로 전송
  - DB 구조, 테이블명 등 내부 정보가 노출될 수 있음
  - 수정: 일반적인 에러 메시지로 대체 ("서버 오류가 발생했습니다")

[보통] 인증 미확인 (전체)
  - /api/user 엔드포인트에 인증 미들웨어가 없음
  - 로그인하지 않은 사용자도 접근 가능
  - 수정: 인증 미들웨어 추가 (requireAuth 등)

[낮음] 에러 후 응답 처리 (Line 4-7)
  - err 발생 시 return 없이 res.json(result)도 실행될 수 있음
  - 수정: if (err) { return res.status(500)... }
```

4개 발견, 각각 설명과 수정 방법 포함.

---

## AI 스캔이 특히 잘 찾는 것들

### 1. 비즈니스 로직 취약점

```
기존 도구: 문법적으로 문제없음 -> 통과!
AI: "할인율을 마이너스로 입력하면 오히려 가격이 올라가는데...
    이게 의도한 건 아닐 것 같다" -> 경고!
```

### 2. 여러 파일에 걸친 문제

```
파일 A: 사용자 입력을 받아서 session에 저장
파일 B: session에서 꺼내서 SQL에 사용 (검증 없이!)

기존 도구: 파일 A -> OK, 파일 B -> OK (각각은 문제없어 보임)
AI: "A에서 받은 입력이 B에서 검증 없이 사용돼요!" -> 경고!
```

### 3. 잘못된 보안 구현

```javascript
// "암호화했으니 안전하지!"... 라고 생각하지만
const encoded = btoa(password);  // Base64는 암호화가 아님! 인코딩일 뿐!

// 기존 도구: btoa() 사용 -> 규칙에 없으면 통과
// AI: "btoa()는 인코딩이지 암호화가 아닙니다.
//     비밀번호를 bcrypt로 해시해야 합니다" -> 경고!
```

---

## 기존 도구가 여전히 필요한 이유

AI가 더 잘 찾는다고 해서 기존 도구가 필요 없는 건 아닙니다!

```
최고의 보안 = CCTV + AI 경비원

CCTV (기존 도구)                AI 경비원 (Claude)
-----                          -----
코드 저장할 때마다               중요한 변경 시
자동으로 빠르게 검사             깊이 있게 분석

   "문법적 문제 없어?"              "진짜 안전해?"
         |                              |
         v                              v
   즉시 피드백 (초 단위)          상세 리포트 (분 단위)

   둘 다 써야 가장 안전!
```

| 상황 | 추천 도구 |
|------|----------|
| 코드 저장할 때마다 빠른 체크 | 기존 도구 (ESLint 등) |
| PR/코드 리뷰 시 깊은 분석 | AI 스캔 |
| 새로운 기능 보안 검토 | AI 스캔 |
| CI/CD 파이프라인 자동 체크 | 기존 도구 |
| 보안 사고 후 전체 점검 | 둘 다 |

---

## 다음 단계

- [Step 1: 취약점 이해하기](../tutorial/step-01-understand-vulns.md) -- 코드 예제로 직접 확인
- [취약 코드 샘플](../examples/vulnerable-code/) -- 의도적으로 만든 취약 코드 분석
