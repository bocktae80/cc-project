window.STUDIO_CONTENT = window.STUDIO_CONTENT || {};
window.STUDIO_CONTENT["14-code-security"] = {
  overview: `## 코드 보안 스캔 — AI로 코드의 약점 찾기

학교에 **CCTV**가 있잖아요? 정해진 곳만 비추죠. 그런데 CCTV가 없는 곳에서 나쁜 일이 생기면?
**AI 보안 경비원**은 CCTV 없는 곳도 직접 돌아다니면서 "수상한 행동"을 찾아냅니다.

코드 보안도 마찬가지! 기존 도구는 알려진 패턴만 찾지만, AI는 코드를 읽고 **"이 부분이 위험할 수 있겠는데?"** 하고 추론합니다.

### CCTV vs AI 경비원

\`\`\`
CCTV (기존 정적분석)               AI 경비원 (Claude 보안 스캔)
────────────────────              ────────────────────────────
정해진 위치만 감시                  건물 전체를 돌아다니며 감시
알려진 패턴만 감지                  수상한 행동 자체를 추론
빠르지만 놓치는 게 많음             느리지만 숨은 위험도 발견
\`\`\`

### 핵심 학습 내용

| 개념 | 설명 |
|------|------|
| OWASP Top 10 | 가장 흔한 보안 취약점 10가지 |
| SQL 인젝션 | 사용자 입력이 DB 명령어에 끼어드는 공격 |
| XSS | 웹 페이지에 악성 스크립트를 심는 공격 |
| AI 보안 스캔 | AI가 맥락을 이해하며 취약점을 추론 |

> **참고**: 보안 스캔은 Enterprise/Team 전용이지만, 개념 학습과 코드 예제는 누구나 따라할 수 있어요!`,

  concepts: [
    {
      id: "what-is-code-security",
      title: "코드 보안이란? (AI 경비원 비유)",
      content: `### CCTV vs AI 경비원

\`\`\`
CCTV (기존 보안 도구)
────────────────────
  [CCTV 1]     [CCTV 2]
  정문 감시     후문 감시
  규칙: 교복X, 무기소지, 출입증X
  → 규칙에 없는 행동은 그냥 통과!

AI 경비원 (Claude 보안 스캔)
────────────────────────────
  [AI 경비원]
  건물 전체를 순찰
  "저 사람은 출입증이 있지만
   왜 서버실 앞에 서성이지?"
  → 맥락을 이해해서 판단!
\`\`\`

#### 왜 코드에 "약점"이 생길까?

대부분의 취약점은 이런 이유로 생겨요:
1. **깜빡함**: 문 잠그는 걸 잊은 것처럼, 입력 검증을 빠뜨림
2. **모르는 것**: 이런 공격이 가능한지 몰랐음
3. **귀찮음**: "설마 악용하겠어?" 하고 넘어감
4. **복잡함**: 코드가 복잡해지면 어디가 뚫려있는지 파악이 어려움

#### OWASP Top 10 (쉬운 버전)

| 순위 | 취약점 | 일상 비유 |
|------|--------|----------|
| 1 | SQL 인젝션 | 택배 주소에 "문 열어" 적기 |
| 2 | XSS | 게시판에 함정 링크 심기 |
| 3 | 인증 우회 | 이름표 없이 교무실 들어가기 |
| 4 | 데이터 노출 | 일기를 투명 가방에 넣기 |
| 5 | 접근 제어 실패 | 학생이 성적 수정하기 |
| 6 | 보안 설정 오류 | 공사 끝났는데 비계를 안 치움 |`
    },
    {
      id: "ai-vs-traditional",
      title: "AI 스캔 vs 기존 정적분석",
      content: `### 두 접근법의 차이

#### 기존 도구 = 단어 검색 (Ctrl+F)

\`\`\`
코드를 한 줄씩 → 규칙 매칭 → 일치하면 경고
결과: "SQL 쿼리에 문자열 연결 사용" → 1건 경고
\`\`\`

#### AI 스캔 = 문장을 읽고 의미 파악

\`\`\`
1. "이 함수는 사용자 입력을 받고 있군"
2. "입력이 HTTP 요청에서 왔네. 외부 입력이다"
3. "검증 없이 SQL에 직접 넣고 있어"
4. "에러 처리도 없어서 공격 정보도 노출될 수 있겠다"
결과: SQL 인젝션 + 정보 노출 + 에러 처리 부재 (복합 취약점)
\`\`\`

#### 비교표

| 비교 항목 | 기존 도구 (CCTV) | AI 스캔 (경비원) |
|-----------|-----------------|----------------|
| 속도 | 매우 빠름 | 느림 |
| 새로운 취약점 | 못 찾음 | 추론으로 발견 |
| 맥락 이해 | 없음 | 있음 |
| 복합 취약점 | 개별만 감지 | 여러 파일 연결 |
| 수정 제안 | 없거나 단순 | 상세한 코드 제안 |

> **최고의 보안 = CCTV + AI 경비원!** 둘 다 써야 가장 안전합니다.`
    }
  ],

  tutorials: [
    {
      id: "step-01",
      title: "취약점 이해하기 (OWASP Top 10)",
      content: `### 코드에서 "약점"을 찾는 눈 키우기

취약점(vulnerability)은 코드에서 공격자가 악용할 수 있는 약점입니다.
대부분 "깜빡해서" 또는 "이런 공격이 있는 줄 몰라서" 생겨요.

#### Top 3 취약점 코드 비교

**SQL 인젝션** (택배 주소에 "문 열어" 적기)

\`\`\`javascript
// 위험: 입력을 SQL에 직접 삽입
const q = "SELECT * FROM users WHERE name = '" + input + "'";
// 공격: input = "'; DROP TABLE users; --"

// 안전: 파라미터화 쿼리
const q = "SELECT * FROM users WHERE name = ?";
db.execute(q, [input]);
\`\`\`

**XSS** (게시판에 함정 심기)

\`\`\`javascript
// 위험: 사용자 입력을 HTML에 직접 삽입
element.insertAdjacentHTML('beforeend', comment);

// 안전: textContent로 텍스트만 표시
div.textContent = comment;
\`\`\`

**인증 우회** (이름표 없이 들어가기)

\`\`\`javascript
// 위험: 인증 없이 접근 가능
app.get('/api/mypage', (req, res) => { ... });

// 안전: 인증 미들웨어 추가
app.get('/api/mypage', requireLogin, (req, res) => { ... });
\`\`\``,
      terminals: [
        {
          command: "# Claude에게 취약 코드 분석 요청",
          output: `> examples/vulnerable-code/sql-injection.js를 읽고
  취약한 부분과 안전한 부분의 차이를 설명해줘

Claude: 파일을 분석하겠습니다...

=== SQL 인젝션 분석 ===

취약한 코드 (Line 8-11):
  사용자 입력을 SQL 문자열에 직접 연결
  → 공격자가 SQL 명령어를 삽입 가능

안전한 코드 (Line 18-21):
  파라미터화 쿼리(?)를 사용
  → 입력이 항상 "값"으로만 취급됨

핵심: "문자열 연결 → 파라미터화 쿼리"가
      SQL 인젝션 방지의 핵심입니다.`
        }
      ]
    },
    {
      id: "step-02",
      title: "보안 스캔 실행 기초",
      content: `### Claude에게 보안 스캔 요청하기

Enterprise/Team 플랜에서는 자동 스캔이 가능하고,
개인 플랜에서도 "이 코드를 보안 관점에서 검토해줘"로 비슷한 분석을 받을 수 있어요.

#### 심각도 등급

\`\`\`
심각 (CRITICAL) = 현관문이 활짝 열림    → 지금 당장!
높음 (HIGH)     = 창문 잠금이 고장남     → 오늘 안에!
보통 (MEDIUM)   = 울타리가 낮음         → 이번 주에
낮음 (LOW)      = 초인종 카메라 화질 낮음 → 시간 될 때
\`\`\`

> Enterprise/Team 전용이지만, 개인 플랜에서도 수동 요청으로 비슷한 분석이 가능합니다.`,
      terminals: [
        {
          command: "# 보안 스캔 요청 (시뮬레이션)",
          output: `> 이 파일을 보안 관점에서 검토해줘: server.js

Claude: 보안 스캔을 실행합니다...

=== 보안 스캔 결과: server.js ===
총 발견: 6건 (심각 2, 높음 2, 보통 1, 낮음 1)

[심각] SQL 인젝션 (Line 8)
  사용자 입력이 SQL에 직접 삽입됨
  수정: 파라미터화 쿼리 사용

[심각] SQL 인젝션 (Line 17)
  userId, newPassword가 SQL에 직접 삽입
  수정: 파라미터화 쿼리 + 인증 확인

[높음] 인증 미확인 (Line 16)
  비밀번호 변경 API에 인증 미들웨어 없음
  수정: requireAuth 추가

[높음] 비밀번호 평문 저장 (Line 17)
  해시 없이 저장. 수정: bcrypt 사용

[보통] 에러 정보 노출 (Line 10)
  수정: 일반 에러 메시지로 대체

[낮음] 응답 중복 (Line 9-12)
  수정: return 추가

권장: 심각→높음 순서로 수정하세요.`
        }
      ]
    },
    {
      id: "step-03",
      title: "발견 → 검증 → 수정 → 재스캔 워크플로우",
      content: `### 4단계 보안 수정 사이클

\`\`\`
1. 발견 (Scan)  → 코드 스캔, 취약점 목록 확인
2. 검증 (Verify) → 진짜 위험한지 확인/분류
3. 수정 (Fix)   → 안전한 코드로 변경
4. 재스캔       → 수정이 제대로 됐는지 확인
   → 새 문제 발견? → 2단계로 돌아가기
   → 문제 없음? → 완료!
\`\`\`

#### Before vs After

\`\`\`
수정 전 (위험)                    수정 후 (안전)
──────────────                   ──────────────
SQL에 직접 삽입                   파라미터화 쿼리
비밀번호 평문 비교                 bcrypt 해시 비교
에러 스택 노출                    일반 메시지만 반환
사용자 정보 전체 반환              필요한 필드만 선택
\`\`\``,
      terminals: [
        {
          command: "# 수정 후 재스캔 (시뮬레이션)",
          output: `> 수정된 login.js를 다시 보안 스캔해줘

Claude: 재스캔을 실행합니다...

=== 보안 재스캔 결과: login.js ===
총 발견: 0건

이전 취약점 수정 확인:
  [해결] SQL 인젝션 → 파라미터화 쿼리로 수정됨
  [해결] 비밀번호 평문 → bcrypt 해시 비교로 변경됨
  [해결] 에러 스택 노출 → 일반 메시지로 변경됨
  [해결] 정보 전체 반환 → 필요 필드만 선택됨

추가 권장사항:
  - 로그인 시도 횟수 제한 (brute force 방지)
  - CSRF 토큰 검증 추가

상태: 통과 (PASS)`
        }
      ]
    }
  ],

  examples: [
    {
      id: "vulnerable-code",
      title: "취약 코드 샘플 분석",
      content: `### 의도적으로 만든 취약 코드 살펴보기

교육용으로 만들어진 3가지 취약 코드 예제입니다.
각각 "취약한 버전"과 "안전한 버전"이 함께 있어요.

#### 파일 목록

| 파일 | 취약점 유형 | 비유 |
|------|-----------|------|
| sql-injection.js | SQL 인젝션 | 택배 주소에 명령어 적기 |
| xss-example.js | XSS | 게시판에 함정 심기 |
| broken-auth.js | 인증 우회 | 이름표 없이 들어가기 |

#### 학습 방법

\`\`\`bash
# Claude에게 분석 요청
> examples/vulnerable-code/sql-injection.js를 읽고
  취약한 부분과 안전한 부분의 차이를 설명해줘

# 또는 전체 폴더 분석
> examples/vulnerable-code/ 폴더의 파일들을
  보안 관점에서 분석해줘
\`\`\`

> **중요**: 이 코드들은 교육용입니다. 실제 프로젝트에 취약한 버전을 사용하면 안 돼요!`,
      checklist: [
        "SQL 인젝션의 위험한 코드와 안전한 코드를 구분할 수 있다",
        "XSS 공격이 어떻게 작동하는지 이해한다",
        "인증 우회의 원리를 설명할 수 있다",
        "각 취약점의 수정 방법을 알고 있다"
      ]
    },
    {
      id: "scan-and-fix",
      title: "스캔 + 수정 실전 워크플로우",
      content: `### 취약 코드를 스캔하고 수정하는 전체 과정

#### 실습 순서

1. **스캔**: 취약 코드를 Claude에게 분석 요청
2. **분류**: 심각도별로 정리
3. **수정**: 우선순위대로 하나씩 고치기
4. **재스캔**: 수정 결과 검증

#### 실습 요청 예시

\`\`\`bash
# SQL 인젝션 수정
> sql-injection.js의 취약한 함수들을 안전하게 수정해줘.
  파라미터화 쿼리를 사용해줘.

# XSS 수정
> xss-example.js의 취약한 부분을 수정해줘.
  사용자 입력은 항상 이스케이프해줘.

# 인증 수정
> broken-auth.js에 적절한 인증과 토큰 관리를 추가해줘.
\`\`\`

> 수정 후에는 반드시 "다시 스캔해줘"로 재검증하세요!`,
      checklist: [
        "4단계 보안 수정 사이클을 실행할 수 있다",
        "심각도별 우선순위를 정할 수 있다",
        "수정 후 재스캔으로 검증하는 습관을 이해한다"
      ]
    },
    {
      id: "security-checklist",
      title: "보안 체크리스트 만들기",
      content: `### 내 프로젝트에 맞는 보안 점검표 만들기

#### 기본 보안 체크리스트 템플릿

\`\`\`
=== 보안 체크리스트 ===

[입력 검증]
[ ] 모든 사용자 입력에 검증이 있는가?
[ ] SQL 쿼리에 파라미터화를 사용하는가?
[ ] HTML 출력 시 이스케이프를 하는가?

[인증/인가]
[ ] 보호된 라우트에 인증 미들웨어가 있는가?
[ ] 다른 사용자의 리소스에 접근할 수 없는가?

[데이터 보호]
[ ] 비밀번호가 해시되어 저장되는가?
[ ] API 키나 시크릿이 코드에 없는가?

[에러 처리]
[ ] 에러 메시지에 내부 정보가 노출되지 않는가?
[ ] try-catch로 예외가 처리되는가?
\`\`\`

#### Claude에게 맞춤 체크리스트 요청

\`\`\`bash
> 이 프로젝트에 맞는 보안 체크리스트를 만들어줘.
  현재 사용 중인 기술 스택과 API 구조를 고려해서.
\`\`\`

> **팁**: 프로젝트마다 보안 요구사항이 다르니, 범용 + 맞춤 체크리스트를 조합하세요!`,
      checklist: [
        "기본 보안 체크리스트 항목을 알고 있다",
        "프로젝트에 맞는 체크리스트를 만들 수 있다",
        "Claude에게 맞춤 체크리스트를 요청할 수 있다"
      ]
    }
  ],

  quiz: [
    {
      question: "AI 보안 스캔과 기존 정적분석의 가장 큰 차이는?",
      options: [
        "AI가 더 빠르다",
        "AI는 코드의 맥락을 이해하고, 기존 도구는 패턴만 매칭한다",
        "기존 도구가 더 정확하다"
      ],
      answer: 1,
      explanation: "기존 도구는 '규칙에 있는 패턴'만 찾지만, AI는 코드의 맥락과 데이터 흐름을 이해해서 '수상한 행동'을 추론합니다. CCTV vs AI 경비원의 차이와 같아요."
    },
    {
      question: "SQL 인젝션을 방지하는 올바른 방법은?",
      options: [
        "사용자 입력을 SQL 문자열에 직접 넣는다",
        "파라미터화 쿼리(?)를 사용한다",
        "SQL 대신 NoSQL을 사용한다"
      ],
      answer: 1,
      explanation: "파라미터화 쿼리는 사용자 입력을 항상 '값'으로만 취급해서, SQL 명령어로 실행되는 것을 방지합니다."
    },
    {
      question: "보안 스캔에서 '심각(CRITICAL)' 등급은 어떤 의미인가요?",
      options: [
        "나중에 시간 될 때 수정하면 됨",
        "즉시 수정 필요, 데이터 유출이나 시스템 장악 가능성",
        "코드 품질은 낮지만 보안 위험은 없음"
      ],
      answer: 1,
      explanation: "심각(CRITICAL)은 공격자가 즉시 악용 가능한 수준의 취약점입니다. 현관문이 활짝 열려있는 것과 같아서, 지금 당장 잠가야 해요!"
    },
    {
      question: "취약점 수정 후에 꼭 해야 하는 것은?",
      options: [
        "코드를 바로 배포한다",
        "재스캔으로 수정이 제대로 됐는지 확인한다",
        "취약한 코드를 주석 처리한다"
      ],
      answer: 1,
      explanation: "수정 후에는 반드시 재스캔을 해서 1) 취약점이 실제로 해결됐는지, 2) 수정 과정에서 새로운 문제가 생기지 않았는지 확인해야 합니다."
    },
    {
      question: "XSS 공격을 비유하면?",
      options: [
        "택배 주소에 '문 열어'라고 적는 것",
        "교실 게시판에 함정 링크를 붙여놓는 것",
        "이름표 없이 교무실에 들어가는 것"
      ],
      answer: 1,
      explanation: "XSS는 게시판 같은 곳에 악성 스크립트를 심어두면, 그 글을 읽은 다른 사용자의 브라우저에서 악성 코드가 실행되는 공격입니다. 게시판에 함정을 심는 것과 같아요."
    }
  ]
};
